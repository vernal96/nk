!function(e,t,n,a){"use strict";var r={name:"Form",props:{useFile:{type:Boolean,required:!1,default:!1},fullWidth:{type:Boolean,required:!1,default:!1},fastpay:{type:Boolean,required:!1,default:!1},successFunction:{type:Function,required:!1,default:null}},data:function(){return{loading:!1,totalError:"",lang:{placeholder:{name:BX.message.DK_NK_PLACEHOLDER_NAME,phone:BX.message.DK_NK_PLACEHOLDER_PHONE,email:BX.message.DK_NK_PLACEHOLDER_EMAIL,ft:BX.message.PLACEHOLDER_FT,inn:BX.message.PLACEHOLDER_INN,delivery:BX.message.PLACEHOLDER_DELIVERY,city:BX.message.PLACEHOLDER_CITY,street:BX.message.PLACEHOLDER_STREET,house:BX.message.PLACEHOLDER_HOUSE,corpus:BX.message.PLACEHOLDER_CORPUS,entrance:BX.message.PLACEHOLDER_ENTRANCE,office:BX.message.PLACEHOLDER_OFFICE,market:BX.message.PLACEHOLDER_MARKET,file:BX.message.PLACEHOLDER_FILE,fileMax:BX.message.PLACEHOLDER_FILE_MAX,comment:BX.message.PLACEHOLDER_COMMENT},title:{name:BX.message.DK_NK_TITLE_NAME,phone:BX.message.DK_NK_TITLE_PHONE,email:BX.message.DK_NK_TITLE_EMAIL,comment:BX.message.DK_NK_TITLE_COMMENT,ft:BX.message.TITLE_FT,inn:BX.message.TITLE_INN,city:BX.message.TITLE_CITY,street:BX.message.TITLE_STREET,home:BX.message.TITLE_HOUSE,corpus:BX.message.TITLE_CORPUS,entrance:BX.message.TITLE_ENTRANCE,office:BX.message.TITLE_OFFICE,market:BX.message.TITLE_MARKET},submit:BX.message.CART_SUBMIT,agreeText:"",org:{name:BX.message.CART_ORG_NAME,director:BX.message.CART_ORG_DIRECTOR,fio:BX.message.CART_ORG_FIO,address:BX.message.CART_ORG_ADDRESS,notFound:BX.message.CART_ORG_NOT_FOUND},fileError:BX.message.CART_FILE_ERROR},deliveryInfo:DK.deliveries,agree:!1,form:{name:"",phone:"",email:"",ft:"",inn:"",delivery:"delivery",deliveryData:{city:"",street:"",house:"",corpus:"",entrance:"",office:"",marketId:0},comment:"",files:[]},ft:[{value:"jur",title:BX.message.FT_JUR},{value:"pht",title:BX.message.FT_PHT}],delivery:[{value:"delivery",title:BX.message.DELIVERY},{value:"self",title:BX.message.SELF_DELIVERY}],companyData:null,companyDataError:!1,fileError:[],deliveryCities:[],markets:[],errorFields:[]}},computed:{ready:function(){return this.deliveryCities.length&&this.markets.length&&this.lang.agreeText}},watch:{ready:function(e){e&&this.$emit("onReady")}},emits:["onReady","onSuccess"],methods:{phoneInput:function(e){a.PhoneEvents.onInput(e)},phonePaste:function(e){a.PhoneEvents.onPaste(e)},phoneKeydown:function(e){a.PhoneEvents.onKeyDown(e)},setFormFt:function(e){this.form.ft=e,this.saveField(e,"ft"),this.removeError("ft")},setFormCity:function(e){this.form.deliveryData.city=e,this.saveField(e,"city"),this.removeError("city")},setFormMarket:function(e){this.form.deliveryData.marketId=e,this.saveField(e,"marketId"),this.removeError("marketId")},getDeliveryCities:function(){var e=this;BX.ajax.runComponentAction("dk:cart","getDeliveryCities",{mode:"class"}).then((function(t){e.deliveryCities=t.data}))},getMarkets:function(){var e=this;BX.ajax.runComponentAction("dk:cart","getMarkets",{mode:"class"}).then((function(t){e.markets=t.data}))},getAgreeText:function(){var e=this;BX.ajax.runComponentAction("dk:cart","getAgreeText",{mode:"class"}).then((function(t){e.lang.agreeText=t.data}))},checkFile:function(e){var t=this;this.form.files=[],this.fileError=[],Array.from(e.target.files).forEach((function(e){e.size<1e6*maxFileSize?t.form.files.push(e):t.fileError.push(e.name)}))},getCompanyByInn:function(){var e=this;if(""===this.form.inn)return this.companyDataError=!1,void(this.companyData=null);BX.ajax.runComponentAction("dk:cart","getCompanyByInn",{mode:"class",data:{inn:this.form.inn}}).then((function(t){t.data?(e.companyData=t.data,e.companyDataError=!1):(e.companyData=null,e.companyDataError=!0)}))},getUserData:function(){var e=this;BX.ajax.runComponentAction("dk:cart","getUserData",{mode:"class"}).then((function(t){if(t.data){var n=t.data;e.form.name=n.name,e.form.phone=n.phone,e.form.email=n.email,e.form.inn=n.inn,e.form.ft=n.ft,e.form.comment=n.comment,n.delivery&&(e.form.delivery=n.delivery),e.form.deliveryData.city=+n.city,e.form.deliveryData.street=n.street,e.form.deliveryData.house=n.house,e.form.deliveryData.corpus=n.corpus,e.form.deliveryData.entrance=n.entrance,e.form.deliveryData.office=n.office,e.form.deliveryData.marketId=n.marketId}}))},saveFieldName:function(){this.saveField(this.form.name,"name")},saveFieldPhone:function(){this.saveField(this.form.phone,"phone")},saveFieldEmail:function(){this.saveField(this.form.email,"email")},saveFieldINN:function(){this.saveField(this.form.inn,"inn")},saveFieldDeliveryType:function(){this.saveField(this.form.delivery,"delivery")},saveFieldStreet:function(){this.saveField(this.form.deliveryData.street,"street")},saveFieldHouse:function(){this.saveField(this.form.deliveryData.house,"house")},saveFieldCorpus:function(){this.saveField(this.form.deliveryData.corpus,"corpus")},saveFieldEntrance:function(){this.saveField(this.form.deliveryData.entrance,"entrance")},saveFieldOffice:function(){this.saveField(this.form.deliveryData.office,"office")},saveFieldComment:function(){this.saveField(this.form.comment,"comment")},saveField:function(e,t){BX.ajax.runComponentAction("dk:cart","saveOrderField",{mode:"class",data:{field:t,value:e}})},submit:function(e){var t=this;this.loading||(this.loading=!0,BX.ajax.runComponentAction("dk:cart","submit",{mode:"class",data:new FormData(e.target)}).then((function(e){t.totalError="",e.data.success?t.fastpay?(t.loading=!1,t.successFunction&&t.successFunction(e.data.message)):location.reload():(t.errorFields=e.data.fields,t.loading=!1,e.data.error&&(t.totalError=e.data.error))}),(function(e){t.totalError=e.errors[0].message,t.loading=!1})))},removeError:function(e){this.errorFields=this.errorFields.filter((function(t){return t!==e}))}},beforeMount:function(){this.getUserData()},mounted:function(){this.getDeliveryCities(),this.getMarkets(),this.getAgreeText()},components:{Selector:t.Selector},template:'\n<form enctype="multipart/form-data" method="post" class="cart__form" :class="{\'cart__form--full\': fullWidth}" v-if="ready" @submit.prevent="submit">\n    <input type="hidden" value="1" name="fastpay" v-if="fastpay">\n    <div class="note note--error cart__form-item cart__form-item--full" v-if="totalError">\n            <div class="text-content">\n                {{ totalError }}\n            </div>\n        </div>\n    <label class="input input--required cart__form-item">\n        <span class="input__title">{{ lang.title.name }}</span>\n        <input \n        type="text" \n        :placeholder="lang.placeholder.name" \n        v-model="form.name" \n        @change="saveFieldName"\n        :class="{\'is-error\': errorFields.includes(\'name\')}"\n        @focus="removeError(\'name\')"\n        >\n    </label>\n    <label class="input input--required cart__form-item">\n        <span class="input__title">{{ lang.title.phone }}</span>\n        <input \n        type="tel" \n        :placeholder="lang.placeholder.phone" \n        v-model="form.phone"\n        @input="phoneInput"\n        @paste="phonePaste"\n        @keydown="phoneKeydown"\n        @change="saveFieldPhone"\n        :class="{\'is-error\': errorFields.includes(\'phone\')}"\n        @focus="removeError(\'phone\')"\n        >\n    </label>\n    <label class="input cart__form-item">\n        <span class="input__title">{{ lang.title.email }}</span>\n        <input \n        type="email" \n        :placeholder="lang.placeholder.email" \n        v-model="form.email" \n        @change="saveFieldEmail"\n        :class="{\'is-error\': errorFields.includes(\'email\')}"\n        @focus="removeError(\'email\')"\n        >\n    </label>\n    <Selector\n    :options="ft"\n    mainClass="cart__form-item"\n    :placeholder="lang.placeholder.ft"\n    @onChange="setFormFt"\n    :title="lang.title.ft"\n    :value="form.ft"\n    :isError="errorFields.includes(\'ft\')"\n    ></Selector>\n    <template v-if="form.ft == \'jur\'">\n        <label class="input input--required cart__form-item cart__form-item--full">\n            <span class="input__title">{{ lang.title.inn }}</span>\n            <input \n            type="number" \n            :placeholder="lang.placeholder.inn" \n            v-model="form.inn"\n            @change="getCompanyByInn(), saveFieldINN()"\n            :class="{\'is-error\': errorFields.includes(\'inn\')}"\n            @focus="removeError(\'inn\')"\n            >\n        </label>\n        <div class="note note--info cart__form-item cart__form-item--full" v-if="companyData">\n            <div class="text-content">\n                <strong>{{ lang.org.name }}:</strong> {{ companyData.name.short_with_opf }}\n                <br>\n                <template v-if="companyData.fio">\n                <strong>{{ lang.org.fio }}:</strong> {{ companyData.fio.surname }} {{ companyData.fio.name }} {{ companyData.fio.patronymic }}\n                </template>\n                <template v-if="companyData.management">\n                <strong>{{ lang.org.director }}:</strong> {{ companyData.management.name }}\n                </template>\n                <br>\n                <strong>{{ lang.org.address }}:</strong> {{ companyData.address.value }}\n            </div>\n        </div>\n        <div class="note note--error cart__form-item cart__form-item--full" v-if="companyDataError">\n            <div class="text-content">\n                {{ lang.org.notFound }}\n            </div>\n        </div>\n    </template>\n    <div class="cart__form-item cart__form-item--full">\n        <div class="form-label">{{ lang.placeholder.delivery }}</div>\n        <div class="form-fieldset form-fieldset--horizontal">\n            <label class="checkbox checkbox--radio" v-for="deliveryType in delivery">\n                <input type="radio" :value="deliveryType.value" v-model="form.delivery" @change="saveFieldDeliveryType">\n                <span class="checkbox__fake"></span>\n                <span class="checkbox__content">{{ deliveryType.title }}</span>\n            </label>\n        </div>\n    </div>\n    <template v-if="form.delivery == \'delivery\'">\n        <div class="cart__form-item cart__form-item--full" v-if="!fastpay">\n            <div class="note note--info text-content">\n                <p v-for="deliveryInfoItem in deliveryInfo">\n                    <b>{{ deliveryInfoItem.title }}</b>\n                    <br>\n                    {{ deliveryInfoItem.description }}\n                </p>\n            </div>\n        </div>\n        <Selector\n        :options="deliveryCities"\n        mainClass="cart__form-item"\n        :placeholder="lang.placeholder.city"\n        :value="form.deliveryData.city"\n        :title="lang.title.city"\n        :isError="errorFields.includes(\'city\')"\n        @onChange="setFormCity"\n        ></Selector>\n        <label class="input cart__form-item">\n            <span class="input__title">{{ lang.title.street }}</span>\n            <input type="text" :placeholder="lang.placeholder.street" v-model="form.deliveryData.street" @change="saveFieldStreet">\n        </label>\n        <label class="input cart__form-item cart__form-item--min">\n            <span class="input__title">{{ lang.title.home }}</span>\n            <input \n            type="text" \n            :placeholder="lang.placeholder.house" \n            v-model="form.deliveryData.house" \n            @change="saveFieldHouse"\n            :class="{\'is-error\': errorFields.includes(\'house\')}"\n            @focus="removeError(\'house\')"\n            >\n        </label>\n        <label class="input cart__form-item cart__form-item--min">\n            <span class="input__title">{{ lang.title.corpus }}</span>\n            <input \n            type="text" \n            :placeholder="lang.placeholder.corpus" \n            v-model="form.deliveryData.corpus" \n            @change="saveFieldCorpus"\n            :class="{\'is-error\': errorFields.includes(\'corpus\')}"\n            @focus="removeError(\'corpus\')"\n            >\n        </label>\n        <label class="input cart__form-item cart__form-item--min">\n            <span class="input__title">{{ lang.title.entrance }}</span>\n            <input \n            type="number" \n            :placeholder="lang.placeholder.entrance" \n            v-model="form.deliveryData.entrance" \n            @change="saveFieldEntrance"\n            :class="{\'is-error\': errorFields.includes(\'entrance\')}"\n            @focus="removeError(\'entrance\')"\n            >\n        </label>\n        <label class="input cart__form-item cart__form-item--min">\n            <span class="input__title">{{ lang.title.office }}</span>\n            <input \n            type="number" \n            :placeholder="lang.placeholder.office" \n            v-model="form.deliveryData.office" \n            @change="saveFieldOffice"\n            :class="{\'is-error\': errorFields.includes(\'office\')}"\n            @focus="removeError(\'office\')"\n            >\n        </label>\n    </template>\n    <Selector\n     v-if="form.delivery == \'self\'"\n    :options="markets"\n    mainClass="cart__form-item cart__form-item--full"\n    :placeholder="lang.placeholder.market"\n    :value="form.deliveryData.marketId"\n    @onChange="setFormMarket"\n    :title="lang.title.market"\n    :isError="errorFields.includes(\'marketId\')"\n    ></Selector>\n    <label class="input-file cart__form-item cart__form-item--auto" v-if="useFile">\n        <input type="file" name="files" @change="checkFile">\n        <span\n            class="input-file__button button button--transparent button--bordered button--min button--medium">\n            <i class="icon icon--file button-hover-reverse"></i>\n            {{ lang.placeholder.file }} <template v-if="form.files.length > 0">({{form.files.length}})</template>\n        </span>\n        <span class="input-file__text">{{ lang.placeholder.fileMax }} {{ maxFileSize }}Mb</span>\n    </label>\n    <div class="note note--error input cart__form-item cart__form-item--full" v-if="fileError.length">\n        <div class="text-content">\n        <b>{{ lang.fileError }}</b>\n        <ul>\n            <li v-for="fileName in fileError" :key="fileName">{{ fileName }}</li>\n        </ul>\n        </div>\n    </div>\n    <div class="input cart__form-item cart__form-item--full">\n        <span class="input__title">{{ lang.title.comment }}</span>\n        <textarea :placeholder="lang.placeholder.comment" v-model="form.comment" @change="saveFieldComment"></textarea>\n    </div>\n    <label class="checkbox form-confirm cart__form-item cart__form-item--full">\n        <input type="checkbox" v-model="agree">\n        <span class="checkbox__fake"></span>\n        <span class="checkbox__content" v-html="lang.agreeText"></span>\n    </label>\n    <button \n    class="button button--long cart__form-item cart__form-item--auto" \n    :class="{\'is-loading\': loading}" \n    :disabled="!agree || loading" \n    type="submit"\n    >\n        <span class="loader" v-if="loading"></span>\n        {{ lang.submit }}\n    </button>\n</form>\n<div class="cart__form" v-else>\n    <div class="cart__form-item">\n        <div class="content-loader content-loader--input-h"></div>\n    </div>\n    <div class="cart__form-item">\n        <div class="content-loader content-loader--input-h"></div>\n    </div>\n    <div class="cart__form-item">\n        <div class="content-loader content-loader--input-h"></div>\n    </div>\n    <div class="cart__form-item">\n        <div class="content-loader content-loader--input-h"></div> \n    </div>\n    <div class="cart__form-item cart__form-item--full">\n        <div class="form-label">\n            <div class="content-loader content-loader--14h content-loader--20"></div>\n        </div>\n        <div class="form-fieldset form-fieldset--horizontal">\n            <div class="content-loader content-loader"></div>\n            <div class="content-loader content-loader"></div>\n        </div>\n    </div>\n    <div class="cart__form-item">\n        <div class="content-loader content-loader--input-h"></div>\n    </div>\n    <div class="cart__form-item">\n        <div class="content-loader content-loader--input-h"></div>\n    </div>\n    <div class="cart__form-item cart__form-item--min">\n        <div class="content-loader content-loader--input-h"></div>\n    </div>\n    <div class="cart__form-item cart__form-item--min">\n        <div class="content-loader content-loader--input-h"></div>\n    </div>\n    <div class="cart__form-item cart__form-item--min">\n        <div class="content-loader content-loader--input-h"></div>\n    </div>\n    <div class="cart__form-item cart__form-item--min">\n        <div class="content-loader content-loader--input-h"></div>\n    </div>\n    <div class="cart__form-item cart__form-item--full">\n        <div class="content-loader  content-loader--textarea-h"></div>\n    </div>\n    <div class="cart__form-item cart__form-item--full">\n        <div class="content-loader"></div>\n        <div class="content-loader"></div>\n        <div class="content-loader"></div>\n    </div>\n    <div class="cart__form-item cart__form-item--full">\n        <div class="content-loader content-loader--20h content-loader--40"></div>\n    </div>\n</div>\n'},i={name:"Items",data:function(){return{items:[]}},mounted:function(){var e=this;BX.ajax.runComponentAction("dk:cart","getItems",{mode:"class"}).then((function(t){e.items=t.data}))},components:{Sizes:n.Sizes},template:'\n<div class="cart__items">\n    <Sizes \n    v-for="item in items"\n    :productId="item.id"\n    :sizeIdList="item.sizes"\n    :full="true"\n    :toggleShow="true"\n    ></Sizes>\n</div>\n'},o={name:"Cart",data:function(){return{showItems:!0,lang:{title:{form:BX.message.CART_TITLE_FORM,items:BX.message.CART_TITLE_ITEMS},currency:BX.message.CURRENCY,point:BX.message.POINT}}},computed:{showButtonText:function(){return this.showItems?BX.message.CART_HIDE_ITEMS:BX.message.CART_SHOW_ITEMS}},methods:{toggleShowItems:function(){this.showItems=!this.showItems}},beforeMounted:function(){var e=this;BX.ajax.runComponentAction("dk:cart","getTotal",{mode:"class"}).then((function(t){e.total=t.data}))},components:{CartForm:r,CartItems:i},template:'\n\t\t<div class="cart__buttons">\n\t\t\t<button \n\t\t\tclass="button button--transparent button--bordered button--long"\n\t\t\t@click="toggleShowItems"\n\t\t\t>{{ showButtonText }}</button>\n\t\t</div>\n\t\t<div class="cart__wrapper">\n\t\t\t<div class="cart__left" :class="{\'cart__left--full\': !showItems}">\n\t\t\t\t<div class="title title--h3 title--min-bottom">{{ lang.title.form }}</div>\n\t\t\t\t<div class="white-block">\n\t\t\t\t\t<CartForm :fullWidth="!showItems"></CartForm>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Transition name="cart-items-slider">\n\t\t\t\t<div class="cart__right" v-show="showItems">\n\t\t\t\t\t<div class="title title--h3 title--min-bottom">{{ lang.title.items }}</div>\n\t\t\t\t\t<CartItems></CartItems>\n\t\t\t\t</div>\n\t\t\t</Transition>\n\t\t</div>\n\t'};e.Cart=o,e.runModalCart=function(){var e=a.Methods.createStructure({classes:["modal","modal-cart"],children:[{classes:["form"],variable:"formWrapper",children:[{classes:["form-content"],children:[{classes:["title","title--h3","title--min-bottom"],content:BX.message.CART_TITLE_FORM},{variable:"form"}]}]}]});BX.Vue3.createApp(r,{useFile:!0,fastpay:!0,successFunction:function(e){var t=window.formWrapper;if(t){t.classList.add("is-success");var n=a.Methods.createStructure({inner:e}).firstElementChild;t.append(n)}}}).mount(window.form),new Fancybox([{src:e,type:"html"}],{dragToClose:!1,Hash:!1,autoFocus:!1})}}(this.DK=this.DK||{},DK,DK,DK);
